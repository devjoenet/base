<script setup lang="ts">
  import TextLink from "@/components/TextLink.vue";
  import { Button } from "@/components/ui/button";
  import { Checkbox } from "@/components/ui/checkbox";
  import { Input } from "@/components/ui/input";
  import { Label } from "@/components/ui/label";
  import AuthBase from "@/layouts/AuthLayout.vue";
  import { store } from "@/routes/login";
  import { request } from "@/routes/password";
  import { Head, useForm } from "@inertiajs/vue3";
  import { Spinner } from "@/components/ui/spinner";

  defineProps<{
    status?: string;
    canResetPassword: boolean;
    canRegister: boolean;
  }>();

  const form = useForm("post", store().url, {
    email: "",
    password: "",
    remember: false,
  });

  function submit(e: SubmitEvent) {
    const el = e.target as HTMLFormElement;

    e.preventDefault();

    if (!el.checkValidity()) {
      el.reportValidity();
      return;
    }

    form.post(store().url);
  }
</script>

<template>
  <AuthBase title="Log in to your account" description="Enter your email and password below to log in">
    <Head title="Log in" />

    <div v-if="status" class="mb-4 text-center text-sm font-medium text-green-600">
      {{ status }}
    </div>

    <form @submit="submit" class="flex flex-col gap-6">
      <div class="grid gap-6">
        <div class="grid gap-2">
          <Input id="email" type="email" name="email" required autocomplete="email" v-model="form.email" label="Email address" />
        </div>
        <div class="grid gap-2">
          <Input id="password" type="password" name="password" required autocomplete="current-password" v-model="form.password" label="Password" />
          <template v-if="canResetPassword">
            <div class="flex justify-between">
              <span />
              <TextLink :href="request()" class="text-sm" :tabindex="5"> Forgot password? </TextLink>
            </div>
          </template>
        </div>
        <div class="flex items-center justify-between">
          <Label for="remember" class="flex items-center space-x-3">
            <Checkbox id="remember" name="remember" :tabindex="3" />
            <span>Remember me</span>
          </Label>
        </div>
        <Button type="submit" class="mt-4 w-full" :tabindex="4" data-test="login-button" :disabled="form.processing">
          <Spinner v-if="form.processing" />
          {{ form.processing ? "Log in" : "Logging in" }}
        </Button>
      </div>
    </form>
  </AuthBase>
</template>
